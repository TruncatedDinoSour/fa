include 'std/mem/gmem.fa'
include 'std/std.fa'

macro NAME_LEN 256 end

macro main
    %NAME_LEN %malloc as name       -- Allocate NAME_LEN buffer

    "Enter your name: " ro %STDOUT
    %fputs                          -- fputs("...", stdout) => null

    %NAME_LEN @name deref %STDIN
    %SYS_read sys 4                 -- read(STDIN, *name, NAME_LEN) => <bytes_read>

    "Your name is " ro %STDOUT
    %fputs                          -- fputs("...", stdout) => null

    1 swap sub @name deref
    %puts                           -- puts(string) => null

    %NAME_LEN @name deref
    %mfree 1 drop                   -- free(name) => null

    %EXIT_SUCCESS %exit

    -- TODO: Add a check for name using conditionals
end

%main
