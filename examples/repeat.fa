include 'std/mem/gmem.fa'
include 'std/std.fa'

macro SIZE 2 128 mul end

macro main
    %SIZE %malloc  -- Allocate SIZE ammount of bytes
    as string      -- Store buffer as a pointer

    "What do I repeat? " ro %STDOUT %fputs

    %SIZE @string deref %STDIN
    %SYS_read sys 4             -- read(STDIN, *string, SIZE) => <bytes_read>

    1 swap sub @string deref
    %puts                       -- puts(string) => null

    %SIZE @string deref %mfree
    1 drop                      -- free(string) => null

    0 %exit
end

%main
