include 'std/syscall.fa'


--<
    Allocate memory

    Takes:
        INT: The buffer size

    Returns:
        INT: *buffer
>--
macro malloc
    as __malloc_length -- Element from the stack

    34             -- Flags
    0              -- Offset
    1 0 sub        -- Fd
    3              -- Prot
    @__malloc_length
    deref          -- Length
    0              -- Addr
    %SYS_mmap sys 7

    unname __malloc_length
end


--<
    Deallocate memory

    Takes:
        INT: The buffer size
        INT: *buffer

    Returns:
        INT: ?error
>--
macro mfree
    %SYS_munmap sys 3
end

